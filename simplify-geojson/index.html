<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeoJSON Simplifier</title>
    <style>
      body {
        font-family: sans-serif;
      }
      pre {
        background: #f0f0f0;
        padding: 10px;
        overflow-x: auto;
        max-height: 300px;
      }
      h2 {
        margin-top: 1em;
      }
    </style>
  </head>
  <body>
    <h1>GeoJSON Simplifier</h1>
    <input type="file" id="fileInput" accept=".geojson" />

    <h2>Original GeoJSON</h2>
    <pre id="before"></pre>

    <h2>Simplified GeoJSON</h2>
    <pre id="after"></pre>
    <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

    <script type="module">
      //   import { simplify } from 'https://cdn.jsdelivr.net/npm/simplify-geojson/+esm';

      const fileInput = document.getElementById('fileInput');
      const beforeEl = document.getElementById('before');
      const afterEl = document.getElementById('after');

      fileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Read original file
        const text = await file.text();
        const geojson = JSON.parse(text);

        // Show original
        beforeEl.textContent = JSON.stringify(geojson, null, 2);

        // Simplify
        // const simplifiedGeoJSON = {
        //   ...geojson,
        //   features: geojson.features.map((f) => simplify(f, 0.1)),
        // };
        const simplifiedGeoJSON = turf.simplify(geojson, {
          tolerance: 0.05,
          highQuality: false,
        });

        // Show simplified
        afterEl.textContent = JSON.stringify(simplifiedGeoJSON, null, 2);

        // Trigger automatic download
        const blob = new Blob([JSON.stringify(simplifiedGeoJSON, null, 2)], {
          type: 'application/json',
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const originalName = file.name.replace(/\.geojson$/i, '');
        a.download = `${originalName}-simplified.geojson`;
        a.href = url;
        a.click();
        URL.revokeObjectURL(url);
      });
    </script>
  </body>
</html>
